// paul irish MIT license
function findTouch(e){for(var t=0;t<currentTouches.length;t++)if(currentTouches[t].id===e)return t;return-1}function removeTouch(e){var t=findTouch(e);t>-1&&currentTouches.splice(t,1)}function addEvents(e,t){function n(n){var i=n.changedTouches;n.preventDefault();e.addEventListener("touchmove",t);e.addEventListener("touchend",r);e.addEventListener("touchcancel",r);for(var s=0;s<i.length;s++)currentTouches.push({id:i[s].identifier,startX:i[s].pageX,startY:i[s].pageY,jitterX:0,jitterY:0})}function r(n){var i=n.changedTouches;n.preventDefault();e.removeEventListener("touchmove",t);e.removeEventListener("touchend",r);e.removeEventListener("touchcancel",r);lastJitter.radius=(lastJitter.radius+1)*(currJitter.radius+1)-1;lastJitter.speed=(lastJitter.speed+1)*(currJitter.speed+1)-1;currJitter.radius=0;currJitter.speed=0;for(var s=0;s<i.length;s++)removeTouch(i[s].identifier)}e.addEventListener("touchstart",n)}function makeClass(){return function(e){if(!(this instanceof arguments.callee))return new arguments.callee(arguments);typeof this.init=="function"&&this.init.apply(this,e.callee?e:arguments)}}function rand(e){return Math.floor(Math.random()*e)}(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var Circle=makeClass();Circle.prototype.init=function(e,t,n,r){this.x=rand(e);this.y=rand(t);this.radius=rand(n);this.color={r:rand(255),g:rand(255),b:rand(255),a:Math.round(Math.random()*100)/100};this.velocity={x:rand(r)-Math.floor(r/2),y:rand(r)-Math.floor(r/2)}};Circle.prototype.rgba=function(){return"rgba("+[this.color.r,this.color.g,this.color.b,this.color.a].join(",")+")"};var cirs=[],currentTouches=[],lastJitter={radius:0,speed:.5,color:0,alpha:0},currJitter={radius:0,speed:0,color:0,alpha:0};$(document).ready(function(){function s(){e.width=n=window.innerWidth;e.height=r=window.innerHeight;i=Math.floor(r/2)}function u(){setTimeout(function(){console.log("speed âˆ† "+(currJitter.speed+lastJitter.speed));u()},1e3)}function a(){t.clearRect(0,0,n,r);for(var e=0;e<cirs.length;e++){var i=cirs[e].radius*(currJitter.radius+1)*(lastJitter.radius+1);t.beginPath();t.arc(cirs[e].x,cirs[e].y,i,0,2*Math.PI,!1);t.closePath();t.fillStyle=cirs[e].rgba();t.fill();var s=currJitter.speed+lastJitter.speed;cirs[e].x+=cirs[e].velocity.x*s;cirs[e].y+=cirs[e].velocity.y*s;var o=currJitter.color,u=currJitter.alpha;cirs[e].color.b+=(o>0?255-cirs[e].color.b:cirs[e].color.b)*o;cirs[e].color.a+=(u>0?1-cirs[e].color.a:cirs[e].color.a)*u;cirs[e].x<0-i&&(cirs[e].x=n+i);cirs[e].y<0-i&&(cirs[e].y=r+i);cirs[e].x>n+i&&(cirs[e].x=0-i);cirs[e].y>r+i&&(cirs[e].y=0-i)}requestAnimationFrame(a)}var e=document.getElementById("can-bg"),t=e.getContext("2d"),n,r,i;addEvents(e,function(e){var t=e.changedTouches;for(var n=0;n<t.length;n++){var r=currentTouches[findTouch(t[n].identifier)];r.jitterX=(t[n].pageX-r.startX)/window.innerWidth;r.jitterY=(t[n].pageY-r.startY)/window.innerHeight;if(n==0){currJitter.speed=r.jitterX;currJitter.radius=r.jitterY}if(n==1){currJitter.color=r.jitterX;currJitter.alpha=r.jitterY}}e.preventDefault()});s();window.addEventListener("resize",s);window.addEventListener("rotate",s);for(var o=0;o<400;o++)cirs.push(Circle(n,r,i,40));a()});